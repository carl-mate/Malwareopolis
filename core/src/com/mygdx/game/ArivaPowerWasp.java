package com.mygdx.game;

import com.badlogic.gdx.scenes.scene2d.Stage;

import java.util.Random;

public class ArivaPowerWasp extends BaseArtillery{
    private YellowEnergyCapsule yellowEnergyCapsule = null;
    private RedEnergyCapsule redEnergyCapsule = null;
    private final float CD = 5.0f;
    private float bloomCooldownTime = CD;
    private boolean hasYellowCapsule = true;
    private boolean hasRedCapsule = true;

    public ArivaPowerWasp(float x, float y, Stage s) {
        super(x, y, s);
        String[] filenames = {"ariva-power-wasp-1.png", "ariva-power-wasp-2.png","ariva-power-wasp-3.png","ariva-power-wasp-4.png"};
        loadAnimationFromFiles(filenames);
    }

//    private void generateYellowEnergyCapsule(float dt){
//        if(!hasDropTarget()) return;
//
//        if(hasYellowCapsule){
//            bloomCooldownTime -= dt;
//        }
//
//        if (bloomCooldownTime < 0 && hasYellowCapsule ) {
//            yellowEnergyCapsule = new YellowEnergyCapsule(0,0, this.getStage(), false);
//            yellowEnergyCapsule.setArivaPowerWaspParent(this);
//            yellowEnergyCapsule.centerAtActor(this);
//            bloomCooldownTime = CD;
//            hasYellowCapsule = false;
//        }
//
//        if (yellowEnergyCapsule == null) {
//            hasYellowCapsule = true;
//        }
//    }

    private void generateEnergyCapsule(float dt){
        if(!hasDropTarget()) return;

        if(hasYellowCapsule || hasRedCapsule){
            bloomCooldownTime -= dt;
        }

        if (bloomCooldownTime < 0 && hasYellowCapsule || bloomCooldownTime < 0 && hasRedCapsule) {
            Random rand = new Random();
            // Yellow Energy Capsule has a 95% chance of spawning, Red Energy Capsule has a 5% chance of spawning
            if(rand.nextInt(100) < 5){
                yellowEnergyCapsule = new YellowEnergyCapsule(0,0, this.getStage(), false);
                yellowEnergyCapsule.setArivaPowerWaspParent(this);
                yellowEnergyCapsule.centerAtActor(this);
                bloomCooldownTime = CD;
                hasYellowCapsule = false;
            } else{
                redEnergyCapsule = new RedEnergyCapsule(0,0, this.getStage(), false);
                redEnergyCapsule.setArivaPowerWaspParent(this);
                redEnergyCapsule.centerAtActor(this);
                bloomCooldownTime = CD;
                hasRedCapsule = false;
            }
        }

        if (yellowEnergyCapsule == null) {
            hasYellowCapsule = true;
        }

        if(redEnergyCapsule == null){
            hasRedCapsule = true;
        }
    }

    public void removeYellowEnergyCapsule () {
        yellowEnergyCapsule = null;
    }

    public void removeRedEnergyCapsule () {
        redEnergyCapsule = null;
    }

    @Override
    public void act(float dt) {
        super.act(dt);
//        generateYellowEnergyCapsule(dt);
        generateEnergyCapsule(dt);
    }
}
